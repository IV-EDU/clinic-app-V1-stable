/**
 * Design System – Clinic App
 * Phase 1: CSS Design Tokens + Dark Mode Foundation
 *
 * This file defines the complete design token system for both light and dark themes.
 * Dark mode is activated via [data-theme="dark"] on the <html> element.
 */

/* ============================================================================
   LIGHT THEME (DEFAULT)
   ========================================================================= */
:root {
  /* Color Palette – Light Mode */
  --color-blue-50: #eff6ff;
  --color-blue-100: #dbeafe;
  --color-blue-200: #bfdbfe;
  --color-blue-300: #93c5fd;
  --color-blue-400: #60a5fa;
  --color-blue-500: #3b82f6;
  --color-blue-600: #2563eb;
  --color-blue-700: #1d4ed8;
  --color-blue-800: #1e40af;
  --color-blue-900: #1e3a8a;

  --color-cyan-400: #22d3ee;
  --color-cyan-500: #06b6d4;
  --color-cyan-600: #0ea5e9;

  --color-slate-50: #f8fafc;
  --color-slate-100: #f1f5f9;
  --color-slate-200: #e2e8f0;
  --color-slate-300: #cbd5e1;
  --color-slate-400: #94a3b8;
  --color-slate-500: #64748b;
  --color-slate-600: #475569;
  --color-slate-700: #334155;
  --color-slate-800: #1e293b;
  --color-slate-900: #0f172a;

  --color-green-50: #f0fdf4;
  --color-green-100: #dcfce7;
  --color-green-200: #bbf7d0;
  --color-green-500: #22c55e;
  --color-green-600: #16a34a;
  --color-green-700: #15803d;

  --color-red-50: #fef2f2;
  --color-red-100: #fee2e2;
  --color-red-200: #fecaca;
  --color-red-500: #ef4444;
  --color-red-600: #dc2626;
  --color-red-700: #b91c1c;

  --color-amber-50: #fffbeb;
  --color-amber-100: #fef3c7;
  --color-amber-200: #fde68a;
  --color-amber-500: #f59e0b;
  --color-amber-600: #d97706;
  --color-amber-700: #b45309;

  --color-white: #ffffff;
  --color-black: #000000;

  /* Semantic Tokens – Light Mode */
  --color-surface: #ffffff;
  --color-surface-raised: #ffffff;
  --color-surface-sunken: #f7f7f8;
  --color-surface-overlay: #ffffff;

  --color-text-primary: #111827;
  --color-text-secondary: #475569;
  --color-text-tertiary: #6b7280;
  --color-text-on-primary: #ffffff;
  --color-text-on-dark: #ffffff;
  --color-text-inverse: #ffffff;

  --color-border: #e5e7eb;
  --color-border-strong: #d1d5db;
  --color-border-subtle: #f3f4f6;

  --color-accent: var(--primary-color, #3b82f6);
  --color-accent-hover: var(--primary-color, #2563eb);
  --color-accent-light: #dbeafe;

  --color-success: #16a34a;
  --color-success-bg: #dcfce7;
  --color-success-border: #bbf7d0;

  --color-warning: #b45309;
  --color-warning-bg: #fef3c7;
  --color-warning-border: #fde68a;

  --color-danger: #b91c1c;
  --color-danger-bg: #fee2e2;
  --color-danger-border: #fecaca;

  --color-info: #0ea5e9;
  --color-info-bg: #e0f2fe;
  --color-info-border: #bae6fd;

  /* Background Gradients – Light Mode */
  --bg-page: linear-gradient(
    90deg,
    color-mix(in srgb, var(--color-accent) 4%, #f9fafb) 0%,
    #fdfdfd 52%,
    color-mix(in srgb, var(--color-accent) 4%, #f9fafb) 100%
  );
  --bg-header: linear-gradient(
    90deg,
    color-mix(in srgb, var(--color-accent) 14%, #ffffff) 0%,
    #fdfdfd 52%,
    color-mix(in srgb, var(--color-accent) 14%, #ffffff) 100%
  );

  /* Typography Scale */
  --font-size-xs: 12px;
  --font-size-sm: 13px;
  --font-size-base: 14px;
  --font-size-md: 16px;
  --font-size-lg: 18px;
  --font-size-xl: 22px;
  --font-size-2xl: 26px;
  --font-size-3xl: 28px;

  --font-weight-normal: 400;
  --font-weight-medium: 600;
  --font-weight-bold: 700;
  --font-weight-extrabold: 800;

  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.6;

  /* Spacing Scale (4px base) */
  --spacing-1: 4px;
  --spacing-2: 8px;
  --spacing-3: 12px;
  --spacing-4: 16px;
  --spacing-5: 20px;
  --spacing-6: 24px;
  --spacing-8: 32px;
  --spacing-10: 40px;
  --spacing-12: 48px;

  /* Border Radius */
  --radius-sm: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-2xl: 20px;
  --radius-full: 999px;

  /* Shadows */
  --shadow-subtle: 0 2px 8px rgba(0, 0, 0, 0.05);
  --shadow-medium: 0 10px 20px rgba(15, 23, 42, 0.08);
  --shadow-strong: 0 18px 38px rgba(15, 23, 42, 0.12);
  --shadow-button: 0 10px 20px rgba(37, 99, 235, 0.15);

  /* Transitions */
  --transition-fast: 0.1s ease;
  --transition-base: 0.2s ease;
  --transition-slow: 0.3s ease;
}


/* ============================================================================
   DARK THEME
   ========================================================================= */
[data-theme="dark"] {
  /* Color Palette – Dark Mode (clinical dark blue-grey, NOT pure black) */
  --color-surface: #1a1d23;
  --color-surface-raised: #22252d;
  --color-surface-sunken: #14171c;
  --color-surface-overlay: #2a2d35;

  --color-text-primary: #f1f5f9;
  --color-text-secondary: #cbd5e1;
  --color-text-tertiary: #94a3b8;
  --color-text-on-primary: #ffffff;
  --color-text-on-dark: #f1f5f9;
  --color-text-inverse: #0f172a;

  --color-border: #374151;
  --color-border-strong: #4b5563;
  --color-border-subtle: #2a2d35;

  --color-accent: var(--primary-color, #60a5fa);
  --color-accent-hover: var(--primary-color, #3b82f6);
  --color-accent-light: #1e3a8a;

  --color-success: #4ade80;
  --color-success-bg: rgba(34, 197, 94, 0.15);
  --color-success-border: #166534;

  --color-warning: #fbbf24;
  --color-warning-bg: rgba(245, 158, 11, 0.15);
  --color-warning-border: #78350f;

  --color-danger: #f87171;
  --color-danger-bg: rgba(239, 68, 68, 0.15);
  --color-danger-border: #7f1d1d;

  --color-info: #38bdf8;
  --color-info-bg: rgba(34, 211, 238, 0.15);
  --color-info-border: #155e75;

  /* Background Gradients – Dark Mode */
  --bg-page: linear-gradient(
    90deg,
    #14171c 0%,
    #1a1d23 52%,
    #14171c 100%
  );
  --bg-header: linear-gradient(
    90deg,
    color-mix(in srgb, var(--color-accent) 8%, #1a1d23) 0%,
    #22252d 52%,
    color-mix(in srgb, var(--color-accent) 8%, #1a1d23) 100%
  );

  /* Shadows – Dark Mode (more subtle) */
  --shadow-subtle: 0 2px 8px rgba(0, 0, 0, 0.3);
  --shadow-medium: 0 10px 20px rgba(0, 0, 0, 0.4);
  --shadow-strong: 0 18px 38px rgba(0, 0, 0, 0.5);
  --shadow-button: 0 10px 20px rgba(96, 165, 250, 0.25);
}


/* ============================================================================
   BACKWARD COMPATIBILITY BRIDGE
   Maps old CSS variables to new design system tokens
   ========================================================================= */
:root,
[data-theme="light"],
[data-theme="dark"] {
  /* Old variable -> new token mappings */
  --ink: var(--color-text-primary);
  --muted: var(--color-text-tertiary);
  --border: var(--color-border);
  --bg: var(--color-surface-sunken);
  --card: var(--color-surface);
  --page-bg: var(--bg-page);

  --green: var(--color-success);
  --green-bg: var(--color-success-bg);
  --red: var(--color-danger);
  --red-bg: var(--color-danger-bg);
  --yellow: var(--color-warning);
  --yellow-bg: var(--color-warning-bg);

  /* --primary-color already set by theme or :root; do NOT alias to --color-accent here
     to avoid overriding the user's chosen theme color in dark mode. */
  --accent-color: var(--color-info);
  --text-primary: var(--color-text-primary);
  --border-strong: var(--color-border-strong);
  --bg-surface: var(--color-surface);
  --btn-text-on-primary: var(--color-text-on-primary);

  --success-color: var(--color-success);
  --success-bg: var(--color-success-bg);
  --warning-color: var(--color-warning);
  --warning-bg: var(--color-warning-bg);
  --danger-color: var(--color-danger);
  --danger-bg: var(--color-danger-bg);
  --info-color: var(--color-info);
  --info-bg: var(--color-info-bg);

  --metric-color: var(--primary-color, var(--color-accent));

  --card-radius: var(--radius-xl);
  --card-padding: var(--spacing-5);
  --card-shadow: var(--shadow-medium);
  --radius-md: var(--radius-md);

  --spacing-sm: var(--spacing-2);
  --spacing-md: var(--spacing-4);
  --spacing-lg: var(--spacing-6);
}


/* ============================================================================
   DARK MODE COMPONENT OVERRIDES
   Comprehensive fix for all hard-coded colors in dark mode.
   Uses broad selectors to catch every element, then specific overrides
   for components that need special treatment.
   ========================================================================= */

/* ---------------------------------------------------------------------------
   A. GLOBAL CATCH-ALL: Convert any remaining hard-coded white backgrounds
      to dark surfaces, and ensure all text is readable.
   -------------------------------------------------------------------------- */

/* Any element with an explicit white/light background → dark surface */
[data-theme="dark"] {
  color-scheme: dark;
}

/* Broad surface resets — catch all the #fff / white / #f8fafc / #f9fafb / #f3f4f6 */
[data-theme="dark"] .card,
[data-theme="dark"] .u-card {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

/* All inputs, selects, textareas */
[data-theme="dark"] input,
[data-theme="dark"] select,
[data-theme="dark"] textarea {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] input::placeholder,
[data-theme="dark"] textarea::placeholder {
  color: var(--color-text-tertiary) !important;
}

/* ---------------------------------------------------------------------------
   B. BUTTONS — Fix hover visibility (the main complaint)
   -------------------------------------------------------------------------- */

/* Primary buttons: brighter hover, no dimming filter */
[data-theme="dark"] .btn:not(:disabled):hover,
[data-theme="dark"] button:not(:disabled):hover {
  filter: brightness(1.15) !important;
}

/* Secondary buttons: visible background on hover */
[data-theme="dark"] .btn.secondary,
[data-theme="dark"] button.secondary,
[data-theme="dark"] a.secondary {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border-strong) !important;
}

[data-theme="dark"] .btn.secondary:not(:disabled):hover,
[data-theme="dark"] button.secondary:not(:disabled):hover,
[data-theme="dark"] a.secondary:not(:disabled):hover {
  background: var(--color-surface-overlay) !important;
  filter: none !important;
}

/* Danger buttons */
[data-theme="dark"] .btn.danger:not(:disabled):hover,
[data-theme="dark"] button.danger:not(:disabled):hover {
  filter: brightness(1.2) !important;
}

/* Success buttons */
[data-theme="dark"] .btn.success:not(:disabled):hover,
[data-theme="dark"] button.success:not(:disabled):hover {
  filter: brightness(1.2) !important;
}

/* Format buttons */
[data-theme="dark"] .format-btn {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border-strong) !important;
}

[data-theme="dark"] .format-btn:hover {
  background: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   C. HEADER / NAV / KEBAB MENU
   -------------------------------------------------------------------------- */
[data-theme="dark"] .header,
[data-theme="dark"] .header.u-app-header,
[data-theme="dark"] .u-app-header {
  background: var(--bg-header) !important;
  border-bottom-color: var(--color-border) !important;
}

[data-theme="dark"] .kebab-menu {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border-strong) !important;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
}

[data-theme="dark"] .kebab-menu a {
  background: var(--color-surface-overlay) !important;
  color: var(--color-accent) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .kebab-menu a:hover {
  background: var(--color-surface-sunken) !important;
}

[data-theme="dark"] .kebab-btn {
  background: var(--color-surface-overlay) !important;
  border-color: var(--color-border-strong) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .user-meta {
  color: var(--color-text-secondary) !important;
}

/* ---------------------------------------------------------------------------
   D. TABLES (admin tables, report tables, patient tables, receipt tables)
   -------------------------------------------------------------------------- */
[data-theme="dark"] table {
  background: var(--color-surface) !important;
}

[data-theme="dark"] table th {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] table td {
  color: var(--color-text-primary) !important;
  border-bottom-color: var(--color-border) !important;
}

[data-theme="dark"] table tbody tr:hover {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] table tbody tr:nth-child(even) {
  background: var(--color-surface-sunken) !important;
}

[data-theme="dark"] table tbody tr:nth-child(even):hover {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .patient-table td {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .patient-table tbody tr:hover td {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .patient-table th {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-primary) !important;
}

/* Reports tables */
[data-theme="dark"] .reports-table td.c {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .doctor-summary-row {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   E. GRIDS (sheet, excel)
   -------------------------------------------------------------------------- */
[data-theme="dark"] .grid .h {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .grid .c {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .grid.excel .c {
  background: var(--color-surface) !important;
}

[data-theme="dark"] .grid.excel .c>input,
[data-theme="dark"] .grid.excel .c>select,
[data-theme="dark"] .grid.excel .c>textarea {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .grid.excel .c>input[readonly] {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-secondary) !important;
}

/* ---------------------------------------------------------------------------
   F. MODALS (all types)
   -------------------------------------------------------------------------- */
[data-theme="dark"] .modal-content,
[data-theme="dark"] .modal-dialog .modal-content,
[data-theme="dark"] #viewReceiptModal .modal-content,
[data-theme="dark"] #printReceiptModal .modal-content,
[data-theme="dark"] #formModal .modal-content,
[data-theme="dark"] #mergePatientModal .modal-content,
[data-theme="dark"] #deleteTreatmentModal .modal-content,
[data-theme="dark"] #deletePaymentModal .modal-content,
[data-theme="dark"] #removeInitialPaymentModal .modal-content {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border: 1px solid var(--color-border-strong) !important;
  box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5) !important;
}

/* Modal overlay — darker in dark mode for better separation */
[data-theme="dark"] .modal-overlay,
[data-theme="dark"] .ce-modal-overlay,
[data-theme="dark"] .schedule-modal {
  background: rgba(0, 0, 0, 0.75) !important;
}

[data-theme="dark"] .modal-header {
  background: var(--color-surface-raised) !important;
  border-bottom-color: var(--color-border) !important;
}

[data-theme="dark"] .modal-footer {
  background: var(--color-surface-raised) !important;
  border-top-color: var(--color-border) !important;
}

[data-theme="dark"] .modal-title {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .modal-close,
[data-theme="dark"] .modal-header .close {
  color: var(--color-text-tertiary) !important;
}

[data-theme="dark"] .modal-close:hover,
[data-theme="dark"] .modal-header .close:hover {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .modal-body {
  scrollbar-color: var(--color-border-strong) transparent !important;
}

/* Schedule modals */
[data-theme="dark"] .schedule-modal__panel {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .schedule-modal__close {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .schedule-modal__body dt {
  color: var(--color-text-secondary) !important;
}

/* Reports modals */
[data-theme="dark"] .reports-modal-dialog {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .reports-modal-header {
  border-bottom-color: var(--color-border) !important;
}

[data-theme="dark"] .reports-modal-close {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .reports-modal-close:hover {
  background: var(--color-surface-overlay) !important;
}

[data-theme="dark"] .reports-modal-footer {
  border-top-color: var(--color-border) !important;
}

/* Delete modal text */
[data-theme="dark"] #deleteTreatmentModal .text-danger,
[data-theme="dark"] #deletePaymentModal .text-danger,
[data-theme="dark"] #removeInitialPaymentModal .text-danger {
  color: var(--color-danger) !important;
}

[data-theme="dark"] #deleteTreatmentModal .text-muted,
[data-theme="dark"] #deletePaymentModal .text-muted,
[data-theme="dark"] #removeInitialPaymentModal .text-muted {
  color: var(--color-text-secondary) !important;
}

/* ---------------------------------------------------------------------------
   G. FORMS (labels, inputs, groups)
   -------------------------------------------------------------------------- */
[data-theme="dark"] .form-label {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .form-input,
[data-theme="dark"] .form-select,
[data-theme="dark"] .modal-form-input {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .form-input:focus,
[data-theme="dark"] .form-select:focus {
  border-color: var(--color-accent) !important;
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2) !important;
}

[data-theme="dark"] .admin-form {
  color: var(--color-text-primary) !important;
}

/* Payment forms */
[data-theme="dark"] .payment-form-card .grid.excel,
[data-theme="dark"] .payment-form-card .payment-form-grid {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .payment-field-group {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .payment-field-control>input,
[data-theme="dark"] .payment-field-control>select,
[data-theme="dark"] .payment-field-control>textarea {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

/* Patient header in form */
[data-theme="dark"] .payment-patient-header {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   H. PAYMENT CARDS & ITEMS
   -------------------------------------------------------------------------- */
[data-theme="dark"] .payment-card {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .payment-card.ok {
  background: color-mix(in srgb, var(--color-success) 8%, var(--color-surface)) !important;
  border-color: var(--color-success-border) !important;
}

[data-theme="dark"] .payment-card.due {
  background: color-mix(in srgb, var(--color-danger) 8%, var(--color-surface)) !important;
  border-color: var(--color-danger-border) !important;
}

[data-theme="dark"] .payment-item {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .payment-item.ok {
  background: color-mix(in srgb, var(--color-success) 8%, var(--color-surface)) !important;
  border-color: var(--color-success-border) !important;
}

[data-theme="dark"] .payment-item.due {
  background: color-mix(in srgb, var(--color-danger) 8%, var(--color-surface)) !important;
  border-color: var(--color-danger-border) !important;
}

[data-theme="dark"] .payment-card .print-receipt-btn {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .payment-card .print-receipt-btn:hover {
  background: var(--color-surface-overlay) !important;
}

[data-theme="dark"] .payment-summary-card .payment-patient-grid .c {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
}

/* Balance badges */
[data-theme="dark"] .bal-0 {
  background: var(--color-success-bg) !important;
  color: var(--color-success) !important;
  border-color: var(--color-success-border) !important;
}

[data-theme="dark"] .bal-pos {
  background: var(--color-danger-bg) !important;
  color: var(--color-danger) !important;
  border-color: var(--color-danger-border) !important;
}

/* ---------------------------------------------------------------------------
   I. PATIENT DETAIL PAGE
   -------------------------------------------------------------------------- */
[data-theme="dark"] .patient-notes,
[data-theme="dark"] .patient-pages {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .summary-item {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .meta-block {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .page-chip {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

/* Merge suggestion/preview */
[data-theme="dark"] .merge-suggestions {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .merge-selection-preview {
  background: color-mix(in srgb, var(--color-accent) 10%, var(--color-surface)) !important;
  border-color: var(--color-accent) !important;
}

[data-theme="dark"] .merge-preview-name {
  color: var(--color-accent) !important;
}

[data-theme="dark"] .merge-preview-details {
  color: var(--color-text-secondary) !important;
}

/* ---------------------------------------------------------------------------
   J. APPOINTMENT PAGE
   -------------------------------------------------------------------------- */
[data-theme="dark"] .appointment-hero {
  background: var(--bg-header) !important;
}

[data-theme="dark"] .appt-card {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .appt-card.status-done {
  background: color-mix(in srgb, var(--color-info) 10%, var(--color-surface-raised)) !important;
  border-color: var(--color-info-border) !important;
}

[data-theme="dark"] .appt-card.status-in_progress {
  background: color-mix(in srgb, var(--color-warning) 10%, var(--color-surface-raised)) !important;
  border-color: var(--color-warning-border) !important;
}

[data-theme="dark"] .appt-card.status-cancelled {
  background: color-mix(in srgb, var(--color-danger) 10%, var(--color-surface-raised)) !important;
  border-color: var(--color-danger-border) !important;
}

[data-theme="dark"] .appt-body .pill {
  background: var(--color-surface-overlay) !important;
  color: var(--color-accent) !important;
  border-color: var(--color-accent) !important;
}

[data-theme="dark"] .appt-body .notes {
  background: var(--color-surface) !important;
  color: var(--color-text-secondary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .appointment-stats .stat-tile {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .appt-snippet {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .timeline-hour {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .empty-hour {
  color: var(--color-text-tertiary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .modal-schedule-item {
  border-color: var(--color-border) !important;
  background: var(--color-surface) !important;
}

/* ---------------------------------------------------------------------------
   K. TEXT COLORS — Fix all hard-coded dark text to light
   -------------------------------------------------------------------------- */
[data-theme="dark"] .appointment-hero .eyebrow {
  color: var(--color-accent) !important;
}

[data-theme="dark"] .appointment-hero label,
[data-theme="dark"] .appointment-form label,
[data-theme="dark"] .receipt-form label,
[data-theme="dark"] .receipt-form .form-label {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .appt-patient {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .stat-label {
  color: var(--color-text-tertiary) !important;
}

[data-theme="dark"] .hour-label {
  color: var(--color-text-tertiary) !important;
}

[data-theme="dark"] .bonus-inline {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .btn-link {
  color: var(--color-accent) !important;
}

[data-theme="dark"] .receipt-hero .eyebrow {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .patient-name {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .patient-details {
  color: var(--color-text-tertiary) !important;
}

[data-theme="dark"] .payment-label {
  color: var(--color-text-tertiary) !important;
}

[data-theme="dark"] .payment-value {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .doctor-name {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .receipt-section-title {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .receipt-title {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .receipt-subtitle {
  color: var(--color-text-secondary) !important;
}

/* ---------------------------------------------------------------------------
   L. LOGIN PAGE
   -------------------------------------------------------------------------- */
[data-theme="dark"] .login-card {
  background: linear-gradient(145deg, var(--color-surface), var(--color-surface-raised)) !important;
}

[data-theme="dark"] .login-title {
  color: var(--color-text-primary) !important;
}

/* ---------------------------------------------------------------------------
   M. REPORTS PAGE
   -------------------------------------------------------------------------- */
[data-theme="dark"] .reports-doctor-chip {
  background: color-mix(in srgb, var(--color-accent) 15%, var(--color-surface)) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   N. RECEIPT FORM SPECIAL STYLES (elderly-optimized)
   -------------------------------------------------------------------------- */
[data-theme="dark"] .receipt-form .modal-patient-info {
  background: var(--color-surface-sunken) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .receipt-form .patient-details span {
  border-bottom-color: var(--color-border) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .receipt-form .modal-payment-summary {
  background: color-mix(in srgb, var(--color-accent) 8%, var(--color-surface)) !important;
  border-color: var(--color-accent) !important;
}

[data-theme="dark"] .receipt-form .payment-row {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .receipt-form .payment-label {
  color: var(--color-accent) !important;
}

[data-theme="dark"] .receipt-form .modal-notes {
  background: color-mix(in srgb, var(--color-warning) 10%, var(--color-surface)) !important;
  border-color: var(--color-warning-border) !important;
  color: var(--color-warning) !important;
}

[data-theme="dark"] .receipt-form .form-input,
[data-theme="dark"] .receipt-form .modal-form-input {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

/* Receipt sections */
[data-theme="dark"] .receipt-section {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* Receipt header */
[data-theme="dark"] .receipt-header {
  background: linear-gradient(135deg, var(--color-surface-sunken), var(--color-surface-raised)) !important;
  border-color: var(--color-border) !important;
}

/* Receipt action button */
[data-theme="dark"] .receipt-action-btn {
  background: var(--color-surface-raised) !important;
  color: var(--color-accent) !important;
}

[data-theme="dark"] .receipt-action-btn:hover {
  background: var(--color-surface-overlay) !important;
}

/* ---------------------------------------------------------------------------
   O. MISC COMPONENTS
   -------------------------------------------------------------------------- */

/* Badge */
[data-theme="dark"] .badge {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

/* View toggle */
[data-theme="dark"] .view-toggle-btn.active {
  background: color-mix(in srgb, var(--color-accent) 20%, var(--color-surface)) !important;
  border-color: var(--color-accent) !important;
  color: var(--color-accent) !important;
}

/* Info chips */
[data-theme="dark"] .info-chip.status-pill {
  background: var(--color-success-bg) !important;
  color: var(--color-success) !important;
  border-color: var(--color-success-border) !important;
}

/* Back link */
[data-theme="dark"] .back-link {
  color: var(--color-text-primary) !important;
  border-color: var(--color-border-strong) !important;
}

/* Search bar */
[data-theme="dark"] .dashboard-search-card .search-input input {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
}

/* Arabic section */
[data-theme="dark"] .arabic-section {
  background: color-mix(in srgb, var(--color-accent) 8%, var(--color-surface)) !important;
}

/* Alert styles in modals */
[data-theme="dark"] .alert-error {
  background: var(--color-danger-bg) !important;
  color: var(--color-danger) !important;
  border-color: var(--color-danger-border) !important;
}

/* Flash messages — ensure they are readable */
[data-theme="dark"] .flash-message:focus-visible {
  outline-color: var(--color-accent) !important;
}

/* Stat pills and dash stats */
[data-theme="dark"] .stat-pill,
[data-theme="dark"] .dash-stat {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* Summary boxes */
[data-theme="dark"] .summary-box {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* Payment note */
[data-theme="dark"] .payment-note {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* Payment field */
[data-theme="dark"] .payment-field {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* u- utility styles from theme-system.css */
[data-theme="dark"] .u-btn.secondary {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .u-chip {
  background: color-mix(in srgb, var(--color-accent) 15%, var(--color-surface)) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   P. ADMIN SETTINGS PAGE (mega-page with inline styles)
   -------------------------------------------------------------------------- */

/* Tab navigation */
[data-theme="dark"] .admin-tabs {
  background: var(--color-surface-raised) !important;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
}

[data-theme="dark"] .admin-tab {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-secondary) !important;
  border-bottom-color: transparent !important;
}

[data-theme="dark"] .admin-tab:hover {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .admin-tab.active {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-bottom-color: var(--color-accent) !important;
}

/* Tab content area */
[data-theme="dark"] .admin-tab-content {
  background: var(--color-surface-raised) !important;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3) !important;
}

/* Card headers and titles */
[data-theme="dark"] .card-header {
  border-bottom-color: var(--color-border) !important;
}

[data-theme="dark"] .card-title {
  color: var(--color-text-primary) !important;
}

/* Admin tables */
[data-theme="dark"] .admin-table th {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .admin-table tbody td {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .admin-table tbody tr:hover td {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .admin-table tr.protected td {
  background: color-mix(in srgb, var(--color-warning) 10%, var(--color-surface)) !important;
  border-color: var(--color-warning-border) !important;
}

[data-theme="dark"] .admin-table tr.protected:hover td {
  background: color-mix(in srgb, var(--color-warning) 15%, var(--color-surface)) !important;
}

/* Compact tables */
[data-theme="dark"] .table-compact th {
  background: var(--color-surface-sunken) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .table-compact td {
  border-bottom-color: var(--color-border) !important;
  color: var(--color-text-primary) !important;
}

/* Status badges */
[data-theme="dark"] .status-badge.active {
  background: var(--color-success-bg) !important;
  color: var(--color-success) !important;
}

[data-theme="dark"] .status-badge.inactive {
  background: var(--color-danger-bg) !important;
  color: var(--color-danger) !important;
}

[data-theme="dark"] .status-badge.admin {
  background: var(--color-warning-bg) !important;
  color: var(--color-warning) !important;
}

[data-theme="dark"] .status-badge.permission {
  background: var(--color-info-bg) !important;
  color: var(--color-info) !important;
}

[data-theme="dark"] .status-badge.more {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-secondary) !important;
}

/* Duplicate cards and chips */
[data-theme="dark"] .dup-cand-card {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .dup-chip {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .dup-chip.warn {
  background: var(--color-warning-bg) !important;
  color: var(--color-warning) !important;
  border-color: var(--color-warning-border) !important;
}

[data-theme="dark"] .dup-chip.info {
  background: var(--color-info-bg) !important;
  color: var(--color-info) !important;
  border-color: var(--color-info-border) !important;
}

/* Data subtab active */
[data-theme="dark"] .data-subtab-btn-active {
  background: color-mix(in srgb, var(--color-accent) 12%, var(--color-surface)) !important;
  border-color: color-mix(in srgb, var(--color-accent) 30%, var(--color-border)) !important;
  color: var(--color-text-primary) !important;
}

/* Data scroll area */
[data-theme="dark"] .data-scroll-area {
  background: var(--color-surface) !important;
  border-color: var(--color-border) !important;
}

/* Checkbox groups */
[data-theme="dark"] .form-checkbox-group {
  border-color: var(--color-border) !important;
  background: var(--color-surface) !important;
}

[data-theme="dark"] .checkbox-group-title {
  color: var(--color-text-primary) !important;
  border-bottom-color: var(--color-border) !important;
}

/* Color preview borders */
[data-theme="dark"] .color-preview,
[data-theme="dark"] .color-input {
  border-color: var(--color-border-strong) !important;
}

/* Admin settings header */
[data-theme="dark"] .admin-settings-header p {
  color: var(--color-text-secondary) !important;
}

/* Data step badges */
[data-theme="dark"] .data-step .badge {
  background: var(--color-surface-overlay) !important;
  border-color: var(--color-border) !important;
  color: var(--color-text-secondary) !important;
}

/* ---------------------------------------------------------------------------
   Q. DIAGNOSIS / MEDICAL / IMAGES (Palmer / Diag+)
   -------------------------------------------------------------------------- */
[data-theme="dark"] .palmer-chart {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .tooth-btn {
  background: var(--color-surface) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .tooth-btn:hover {
  background: var(--color-surface-overlay) !important;
}

[data-theme="dark"] .tooth-btn.selected {
  background: color-mix(in srgb, var(--color-accent) 20%, var(--color-surface)) !important;
  border-color: var(--color-accent) !important;
}

[data-theme="dark"] .diag-form {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .medical-section {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .image-card {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   R. SIMPLE & LEGACY EXPENSES
   -------------------------------------------------------------------------- */
[data-theme="dark"] .expense-card {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .expense-summary {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

/* ---------------------------------------------------------------------------
   S. SCROLLBAR STYLING
   -------------------------------------------------------------------------- */
[data-theme="dark"] * {
  scrollbar-color: var(--color-border-strong) transparent;
}

[data-theme="dark"] ::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

[data-theme="dark"] ::-webkit-scrollbar-track {
  background: transparent;
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
  background: var(--color-border-strong);
  border-radius: 4px;
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
  background: var(--color-text-tertiary);
}

/* ====================================================================
   T) Treatment Cards (inline styles in _list.html)
   ==================================================================== */
[data-theme="dark"] .treatment-card {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .treatment-header {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .treatment-header:hover {
  background: var(--color-surface-overlay) !important;
}

[data-theme="dark"] .treatment-name {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .treatment-toggle {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .meta-item {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .visit-type-chip {
  background: rgba(59, 130, 246, 0.15) !important;
  color: #93c5fd !important;
  border-color: rgba(59, 130, 246, 0.3) !important;
}

[data-theme="dark"] .status-badge.complete {
  background: rgba(16, 185, 129, 0.15) !important;
  color: #6ee7b7 !important;
}

[data-theme="dark"] .status-badge.active {
  background: rgba(245, 158, 11, 0.15) !important;
  color: #fcd34d !important;
}

[data-theme="dark"] .status-badge.visit {
  background: rgba(59, 130, 246, 0.15) !important;
  color: #93c5fd !important;
}

[data-theme="dark"] .fin-label {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .fin-value {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .fin-value.remaining {
  color: #f87171 !important;
}

[data-theme="dark"] .progress-bar-container {
  background: var(--color-surface-sunken) !important;
}

[data-theme="dark"] .progress-text {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .treatment-body {
  background: var(--color-surface-sunken) !important;
  border-top-color: var(--color-border) !important;
}

[data-theme="dark"] .section-actions {
  border-bottom-color: var(--color-border) !important;
}

[data-theme="dark"] .details-section {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .detail-label {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .detail-value {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .payments-section {
  background: var(--color-surface-raised) !important;
}

[data-theme="dark"] .payments-heading {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .payment-row {
  background: var(--color-surface-sunken) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .payment-row.initial {
  background: rgba(16, 185, 129, 0.1) !important;
  border-color: rgba(16, 185, 129, 0.25) !important;
}

[data-theme="dark"] .payment-date {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .payment-amount {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .payment-method {
  color: var(--color-text-tertiary) !important;
}

[data-theme="dark"] .payment-doctor {
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .btn-icon {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .btn-icon:hover {
  background: var(--color-border-strong) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .btn-icon.btn-delete:hover {
  background: rgba(239, 68, 68, 0.2) !important;
  color: #f87171 !important;
}

[data-theme="dark"] .add-payment-wrapper {
  border-top-color: var(--color-border) !important;
}

[data-theme="dark"] .empty-state {
  background: var(--color-surface-sunken) !important;
  border-color: var(--color-border-strong) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .checkbox-label {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .treatment-card .total-row {
  border-top-color: var(--color-border) !important;
}

[data-theme="dark"] .treatments-header-section {
  background: linear-gradient(135deg, var(--color-surface-raised) 0%, var(--color-surface-overlay) 100%) !important;
  border-color: var(--color-border) !important;
}

[data-theme="dark"] .treatments-main-title {
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .stat-badge {
  background: var(--color-surface-overlay) !important;
  color: var(--color-text-secondary) !important;
}

[data-theme="dark"] .stat-badge.count {
  background: rgba(99, 102, 241, 0.15) !important;
  color: #a5b4fc !important;
  border-color: rgba(99, 102, 241, 0.3) !important;
}

[data-theme="dark"] .stat-badge.active {
  background: rgba(245, 158, 11, 0.15) !important;
  color: #fcd34d !important;
}

[data-theme="dark"] .stat-badge.complete {
  background: rgba(16, 185, 129, 0.15) !important;
  color: #6ee7b7 !important;
}

[data-theme="dark"] .stat-badge.visit {
  background: rgba(59, 130, 246, 0.15) !important;
  color: #93c5fd !important;
}

[data-theme="dark"] .stat-badge.due {
  background: rgba(239, 68, 68, 0.15) !important;
  color: #fca5a5 !important;
}

[data-theme="dark"] .doctor-filter {
  background: var(--color-surface-raised) !important;
  border-color: var(--color-border) !important;
  color: var(--color-text-primary) !important;
}

[data-theme="dark"] .loading-overlay {
  background: rgba(26, 29, 35, 0.85) !important;
}

[data-theme="dark"] .message-content {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
}

/* ====================================================================
   U) Admin Settings Header
   ==================================================================== */
[data-theme="dark"] .admin-settings-header {
  background: linear-gradient(135deg,
    color-mix(in srgb, var(--primary-color) 12%, #1a1d23),
    #22252d,
    color-mix(in srgb, var(--primary-color) 12%, #1a1d23)) !important;
}

[data-theme="dark"] .admin-settings-header h2,
[data-theme="dark"] .admin-settings-header p {
  color: var(--color-text-primary) !important;
}

/* ====================================================================
   V) Date inputs in dark mode
   ==================================================================== */
[data-theme="dark"] input[type="date"],
[data-theme="dark"] input[type="time"],
[data-theme="dark"] input[type="datetime-local"] {
  background: var(--color-surface-raised) !important;
  color: var(--color-text-primary) !important;
  border-color: var(--color-border) !important;
  color-scheme: dark;
}

/* Print-specific: force light mode for print, hide non-print elements */
@media print {
  /* Reset dark mode CSS variables to light values for print */
  :root,
  [data-theme="dark"] {
    --color-surface: #ffffff !important;
    --color-surface-raised: #f8fafc !important;
    --color-surface-sunken: #f1f5f9 !important;
    --color-surface-overlay: #ffffff !important;
    --color-text-primary: #0f172a !important;
    --color-text-secondary: #475569 !important;
    --color-text-tertiary: #64748b !important;
    --color-border: #e2e8f0 !important;
    --color-border-strong: #cbd5e1 !important;
    --color-border-subtle: #f1f5f9 !important;
    --color-accent: #2563eb !important;
    --bg-page: #ffffff !important;
    --bg-header: #ffffff !important;
    --shadow-subtle: none !important;
    --shadow-medium: none !important;
    --shadow-strong: none !important;
    /* Bridge variables */
    --ink: #0f172a !important;
    --muted: #64748b !important;
    --border: #e2e8f0 !important;
    --bg: #f9fafb !important;
    --card: #ffffff !important;
    --page-bg: #ffffff !important;
    --text-primary: #0f172a !important;
  }

  /* Force white background on everything — background-image: none is critical
     because dark mode uses a gradient for --bg-page, and gradients are
     background-image, which bleeds into print margins if not explicitly cleared */
  html, body {
    background: #ffffff !important;
    background-image: none !important;
    background-color: #ffffff !important;
    color: #0f172a !important;
  }

  /* Hide dark mode toggle button */
  .theme-toggle-btn,
  #theme-toggle {
    display: none !important;
  }

  /* Hide navigation and other non-print elements */
  .global-search-form,
  .kebab {
    display: none !important;
  }
}

