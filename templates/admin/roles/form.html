{% extends '_base.html' %}
{% block content %}
<div class="card" style="max-width:760px;margin:0 auto">
  <div style="margin-bottom:16px">
    <h1 style="margin:0">{{ t('roles_new_button') if mode == 'create' else t('roles_edit_heading') }}</h1>
    <p class="muted" style="margin:4px 0 0">{{ t('role_permissions_hint') }}</p>
  </div>
  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="row" style="flex-direction:column;gap:12px">
      <label>{{ t('role_form_name') }}
        <input name="name" value="{{ role.name if role else '' }}" required>
      </label>
      <label>{{ t('role_form_description') }}
        <textarea name="description" rows="2">{{ role.description if role and role.description else '' }}</textarea>
      </label>
      <div>
        <div style="font-weight:600;margin-bottom:6px">{{ t('role_form_permissions') }}</div>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:8px">
          {% for perm in permissions %}
          <label style="display:flex;flex-direction:column;border:1px solid var(--border);padding:8px;border-radius:10px;gap:4px">
            <div style="display:flex;align-items:center;gap:6px">
              <input type="checkbox" name="permissions" value="{{ perm.id }}" {% if perm.id in selected_permission_ids %}checked{% endif %}>
              <span style="font-weight:600">{{ perm.code }}</span>
            </div>
            {% if perm.description %}
            <small class="muted">{{ perm.description }}</small>
            {% endif %}
          </label>
          {% endfor %}
        </div>
      </div>
    </div>
    <div style="margin-top:18px;display:flex;gap:8px">
      <button class="btn">{{ t('update') if mode == 'edit' else t('save') }}</button>
      <a class="btn secondary" href="{{ url_for('admin_roles.index') }}">{{ t('cancel') }}</a>
    </div>
  </form>
</div>
{% endblock %}
