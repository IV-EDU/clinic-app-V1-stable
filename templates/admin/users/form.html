{% extends '_base.html' %}
{% block content %}
<div class="card" style="max-width:640px;margin:0 auto">
  <h1 style="margin-top:0">{{ 'Edit User' if user else 'New User' }}</h1>
  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div class="row" style="flex-direction:column;gap:12px">
      <label>Username
        <input name="username" value="{{ user.username if user else '' }}" required>
      </label>
      <label>Full name
        <input name="full_name" value="{{ user.full_name if user else '' }}">
      </label>
      <label>Phone
        <input name="phone" value="{{ user.phone if user else '' }}">
      </label>
      <label>Password {% if user %}(leave blank to keep current){% endif %}
        <input type="password" name="password">
      </label>
      <label style="display:flex;align-items:center;gap:6px">
        <input type="checkbox" name="is_active" value="1" {% if not user or user.is_active %}checked{% endif %}>
        Active
      </label>
      {% set role_count = roles|length %}
      {% set role_size = 6 if role_count > 6 else (role_count if role_count else 3) %}
      <label>Roles
        <select name="roles" multiple size="{{ role_size if role_size else 3 }}" style="width:100%">
          {% for role in roles %}
            <option value="{{ role.id }}" {% if user and role in user.roles %}selected{% endif %}>{{ role.name }}</option>
          {% endfor %}
        </select>
      </label>
    </div>
    <div style="margin-top:16px;display:flex;gap:8px">
      <button class="btn">Save</button>
      <a class="btn secondary" href="{{ url_for('admin_users.index') }}">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
