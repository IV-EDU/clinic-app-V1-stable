<form method="post" action="{{ action }}" class="admin-form u-stack-md" id="editPaymentModalForm">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
    <div class="form-group">
      <label class="form-label">{{ t('amount') }} (EGP) *</label>
      <input
        type="number"
        name="amount"
        class="form-control"
        style="font-weight: 800; color: var(--primary-color); font-size: 1.25rem;"
        min="0"
        step="0.01"
        required
        value="{{ form.amount|default('') }}"
      >
    </div>
    <div class="form-group">
      <label class="form-label">{{ t('date') }}</label>
      <input
        type="date"
        name="paid_at"
        class="form-control"
        style="width: 100%;"
        value="{{ form.paid_at|default(today) }}"
      >
    </div>
  </div>

  <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
    <div class="form-group">
      <label class="form-label">{{ t('method') }}</label>
      {% set method = form.method|default('cash') %}
      <select name="method" class="form-control" style="width: 100%;">
        <option value="cash" {{ 'selected' if method == 'cash' else '' }}>{{ t('cash') }}</option>
        <option value="card" {{ 'selected' if method == 'card' else '' }}>{{ t('card') }}</option>
        <option value="transfer" {{ 'selected' if method == 'transfer' else '' }}>{{ t('transfer') }}</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">{{ t('doctor') }} *</label>
      {% set selected_doctor = form.doctor_id|default('') %}
      <select name="doctor_id" class="form-control" style="width: 100%;" required>
        <option value="">{{ t('select_doctor') }}</option>
        {% for doctor in doctor_options or [] %}
          <option value="{{ doctor['doctor_id'] }}" {{ 'selected' if selected_doctor == doctor['doctor_id'] else '' }}>
            {{ doctor['doctor_label'] }}
          </option>
        {% endfor %}
      </select>
      {% if doctor_error %}
        <div class="field-error doctor-error" style="color: var(--danger-color); font-size: 0.85rem; margin-top: 4px;">{{ doctor_error }}</div>
      {% endif %}
    </div>
  </div>

  <div class="form-group">
    <label class="form-label">{{ t('notes') }}</label>
    <textarea name="note" class="form-control" rows="2" placeholder="{{ t('notes_placeholder') }}">{{ form.note|default('') }}</textarea>
  </div>

  <div class="modal-footer" style="padding: 24px 0 0 0; margin-top: 12px; border-top: 1px solid var(--border-strong); display: flex; justify-content: flex-end; gap: 12px;">
    <button type="button" class="u-btn ghost" onclick="hideFormModal()">{{ t('cancel') }}</button>
    <button type="submit" class="u-btn primary">{{ t('update') }}</button>
  </div>
</form>
