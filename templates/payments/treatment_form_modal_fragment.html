<form method="post" action="{{ action }}" class="admin-form" id="editTreatmentModalForm">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <div class="form-group">
    <label class="form-label">{{ t('treatment_type') }} *</label>
    <input
      type="text"
      name="treatment_type"
      class="form-control"
      required
      value="{{ form.treatment_type|default('') }}"
    >
  </div>

  <div class="form-group">
    {% set is_consultation = form.is_consultation_visit|default('') %}
    <label class="checkbox-label">
      <input type="checkbox" name="is_consultation_visit" value="1" {{ 'checked' if is_consultation else '' }}>
      {{ t('this_is_consultation_visit') }}
    </label>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label class="form-label">{{ t('visit_type') }}</label>
      {% set vt = form.visit_type|default('none') %}
      <select name="visit_type" class="form-control">
        <option value="none" {{ 'selected' if vt == 'none' else '' }}>{{ t('vt_none') }}</option>
        <option value="exam" {{ 'selected' if vt == 'exam' else '' }}>{{ t('vt_exam') }}</option>
        <option value="followup" {{ 'selected' if vt == 'followup' else '' }}>{{ t('vt_follow') }}</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">{{ t('doctor') }} *</label>
      {% set selected_doctor = form.doctor_id|default('') %}
      <select name="doctor_id" class="form-control" required>
        <option value="">{{ t('select_doctor') }}</option>
        {% for doctor in doctor_options or [] %}
          <option value="{{ doctor['doctor_id'] }}" {{ 'selected' if selected_doctor == doctor['doctor_id'] else '' }}>
            {{ doctor['doctor_label'] }}
          </option>
        {% endfor %}
      </select>
      {% if doctor_error %}
        <div class="field-error doctor-error">{{ doctor_error }}</div>
      {% endif %}
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label class="form-label">{{ t('total_amount') }} *</label>
      <input
        type="number"
        name="total_amount"
        class="form-control"
        required
        min="0"
        step="0.01"
        value="{{ form.total_amount|default('') }}"
      >
    </div>
    <div class="form-group">
      <label class="form-label">{{ t('discount') }}</label>
      <input
        type="number"
        name="discount"
        class="form-control"
        min="0"
        step="0.01"
        value="{{ form.discount|default('0') }}"
      >
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label class="form-label">{{ t('date') }}</label>
      <input
        type="date"
        name="paid_at"
        class="form-control"
        value="{{ form.paid_at|default(today) }}"
      >
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
      <label class="form-label">{{ t('method') }}</label>
      {% set method = form.method|default('cash') %}
      <select name="method" class="form-control">
        <option value="cash" {{ 'selected' if method == 'cash' else '' }}>{{ t('cash') }}</option>
        <option value="card" {{ 'selected' if method == 'card' else '' }}>{{ t('card') }}</option>
        <option value="transfer" {{ 'selected' if method == 'transfer' else '' }}>{{ t('transfer') }}</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <label class="form-label">{{ t('notes') }}</label>
    <textarea name="notes" class="form-control" rows="2">{{ form.notes|default('') }}</textarea>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn secondary" onclick="hideFormModal()">{{ t('close') }}</button>
    <button type="submit" class="btn primary">{{ submit_label|default(t('update')) }}</button>
  </div>
</form>
