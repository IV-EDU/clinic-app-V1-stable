{% extends '_base.html' %}
{% block content %}
<div class="card receipt-hero">
  <div>
    <div class="eyebrow">{{ t('receipts') }}</div>
    <h1>{{ t('receipts_recent') }}</h1>
  </div>
  <a class="btn" href="{{ url_for('receipts.new') }}">{{ t('receipts_new') }}</a>
</div>
<div class="card receipt-table">
  <table>
    <thead>
      <tr>
        <th>{{ t('receipt_number_label') }}</th>
        <th>{{ t('receipt_patient_label') }}</th>
        <th>{{ t('receipt_date_label') }}</th>
        <th>{{ t('receipts_amount') }}</th>
        <th>{{ t('receipts_locale') }}</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {% for r in receipts %}
      <tr>
        <td>{{ r.number }}</td>
        <td>{{ r.full_name }}</td>
        <td>{{ r.issued_at[:16].replace('T', ' ') }}</td>
        <td>{{ '{:.2f}'.format((r.amount_cents or 0)/100) }}</td>
        <td>{{ r.locale.upper() }}</td>
        <td class="actions">
          <a class="btn secondary" href="{{ url_for('receipts.pdf', rid=r.id) }}">{{ t('receipts_pdf') }}</a>
          <form method="post" action="{{ url_for('receipts.reprint', rid=r.id) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <input type="hidden" name="next" value="{{ request.full_path }}">
            <button class="btn secondary">{{ t('receipts_reprint') }} ({{ r.reprint_count }})</button>
          </form>
        </td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
